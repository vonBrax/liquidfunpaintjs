<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>SUPER COOL</title>
    <!-- <link rel="preload" href="src/liquidfun/a.out.js" as="script"> -->
    <style>
      body {
        margin: 0;
      }
      #canvas {
        width: 100%;
        /* height: 80vh;
        height: 40vh;
        height: calc(100vh - 101px); */
        height: 100%;
        /* width: calc(1764px / 2);
      height: calc(1080px / 2); */
        background: black;
        touch-action: none;
      }

      .absolute {
        position: absolute;
      }

      .top-0 {
        top: 0;
      }

      .left-0 {
        left: 0;
      }

      .right-0 {
        right: 0;
      }

      .bottom-0 {
        bottom: 0;
      }

      .relative {
        position: relative;
      }

      .flex {
        display: flex;
      }

      .pointer-events-none {
        pointer-events: none;
      }

      .whitespace-pre-line {
        white-space: pre-line;
      }

      .text-xs {
        font-size: 0.75rem;
      }

      .justify-evenly {
        justify-content: space-evenly;
      }

      .p-4 {
        padding: 1rem;
      }

      .p-2 {
        padding: 0.5rem;
      }

      .px-2 {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }

      .w-screen {
        width: 100vw;
      }

      .h-screen {
        height: 100vh;
      }

      .hidden {
        visibility: hidden;
        opacity: 0;
        pointer-events: none;
      }

      .debug-controls {
        top: 1rem;
        right: 1rem;
        background-color: white;
      }

      .stats {
        background-color: rgba(0, 0, 0, 0.75);
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="relative flex w-screen h-screen">
      <!-- Width: 1764 - Height: 1080 -->
      <div class="controls absolute top-0 left-0">
        <button id="play" type="button">PLAY</button>
        <button id="pause" type="button">PAUSE</button>
        <button id="reset" type="button">RESET</button>
      </div>
      <canvas id="canvas"></canvas>
      <button
        type="button"
        class="absolute top-0 right-0 rounded-full"
        onclick="showSettings(event)"
      >
        <img src="/assets/settings_18dp.png" />
      </button>
      <div class="debug-controls absolute flex justify-evenly p-4 hidden">
        <button
          type="button"
          class="absolute top-0 left-0 p-2"
          onclick="hideSettings(event)"
        >
          X
        </button>
        <div id="info">
          <p>Info</p>
          <div>
            <label
              ><input type="checkbox" name="info" value="stats" />Stats</label
            >
          </div>
          <div>
            <label
              ><input type="checkbox" name="info" value="debug" checked />Debug
              Render</label
            >
          </div>
          <div>
            <label
              ><input type="checkbox" name="info" value="blur" />Blur
              Renderer</label
            >
          </div>
        </div>

        <div id="tools">
          <p>Tool</p>
          <div>
            <label>
              <input type="radio" name="tool" value="WATER" checked />
              Water
            </label>
          </div>
          <div>
            <label>
              <input type="radio" name="tool" value="RIGID" />
              Rigid
            </label>
          </div>
        </div>

        <div id="colors" style="display: flex">
          <div>
            <p>Color</p>
            <div>
              <label>
                <input type="radio" name="color" value="ffdcb8ff" />
                <span style="color: #dcb8ff; background-color: #dcb8ff"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffb9b7ff" />
                <span style="color: #b9b7ff; background-color: #b9b7ff"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff8c9dff" />
                <span style="color: #8c9dff; background-color: #8c9dff"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff71a0f0" />
                <span style="color: #71a0f0; background-color: #71a0f0"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff55abff" />
                <span style="color: #55abff; background-color: #55abff"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff63cee4" checked />
                <span style="color: #63cee4; background-color: #63cee4"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff75ccc7" />
                <span style="color: #75ccc7; background-color: #75ccc7"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff98e1c8" />
                <span style="color: #98e1c8; background-color: #98e1c8"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffb4e5af" />
                <span style="color: #b4e5af; background-color: #b4e5af"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffc0eba8" />
                <span style="color: #c0eba8; background-color: #c0eba8"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffe7f39f" />
                <span style="color: #e7f39f; background-color: #e7f39f"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="fff7eb83" />
                <span style="color: #f7eb83; background-color: #f7eb83"
                  >AI</span
                >
              </label>
            </div>
          </div>
          <div>
            <p>&nbsp;</p>
            <div>
              <label>
                <input type="radio" name="color" value="ffe89a3a" />
                <span style="color: #e89a3a; background-color: #e89a3a"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffe44426" />
                <span style="color: #e44426; background-color: #e44426"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffb5303b" />
                <span style="color: #b5303b; background-color: #b5303b"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff6a2531" />
                <span style="color: #6a2531; background-color: #6a2531"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffd8336e" />
                <span style="color: #d8336e; background-color: #d8336e"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ffad4893" />
                <span style="color: #ad4893; background-color: #ad4893"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff522fa6" />
                <span style="color: #522fa6; background-color: #522fa6"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff2547b0" />
                <span style="color: #2547b0; background-color: #2547b0"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff009100" />
                <span style="color: #009100; background-color: #009100"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff06a481" />
                <span style="color: #06a481; background-color: #06a481"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff563c3b" />
                <span style="color: #563c3b; background-color: #563c3b"
                  >AI</span
                >
              </label>
            </div>
            <div>
              <label>
                <input type="radio" name="color" value="ff0a0a0a" />
                <span style="color: #0a0a0a; background-color: #0a0a0a"
                  >AI</span
                >
              </label>
            </div>
          </div>
        </div>
      </div>
      <div
        id="log"
        class="stats absolute bottom-0 right-0 pointer-events-none p-2 whitespace-pre-line text-xs"
      ></div>
    </div>

    <!-- <script>
    var Module = {
      canvas: document.getElementById('canvas'),
      customMessageQueue: [],
      onCustomMessage: function(event) {
        Module.customMessageQueue.push(event);
      },
      printErr: console.error,
      print: console.info
    };
  </script> -->

    <!-- <script src="static/liquidfun/liquidfun.js"></script> -->

    <script>
      function showSettings(evt) {
        evt.preventDefault();
        document.querySelector('.debug-controls').classList.remove('hidden');
      }

      function hideSettings(evt) {
        evt.preventDefault();
        document.querySelector('.debug-controls').classList.add('hidden');
      }
      // Used once to premultiply image assest.
      function premultiplyAlpha(filename) {
        console.log('Premultiplying: ' + filename);

        return new Promise((resolve, reject) => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const image = new Image();

          image.onload = function () {
            const w = image.naturalWidth || image.width;
            const h = image.naturalHeight || image.height;
            canvas.width = w;
            canvas.height = h;
            canvas.style.width = w + 'px';
            canvas.style.height = h + 'px';
            ctx.drawImage(image, 0, 0);
            const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imgData.data;

            if (isPremultiplied(data)) {
              console.log(
                '%c Skipping ' + filename + ': already premultiplied.',
                'color: black; background-color: yellow;',
              );
              return;
            }

            for (let i = 0; i < data.length; i += 4) {
              const r = data[i];
              const g = data[i + 1];
              const b = data[i + 2];
              const a = data[i + 3];
              const preR = Math.min((a / 255) * r, 255);
              const preG = Math.min((a / 255) * g, 255);
              const preB = Math.min((a / 255) * b, 255);
              data[i] = preR;
              data[i + 1] = preG;
              data[i + 2] = preB;
            }

            ctx.putImageData(imgData, 0, 0);

            const newImg = new Image();
            newImg.onload = function () {
              resolve(newImg);
            };

            newImg.onerror = function (e) {
              reject(e);
            };

            newImg.src = canvas.toDataURL();

            document.body.appendChild(newImg);
          };

          image.src = '/static/' + filename;
        });
      }

      function isPremultiplied(data) {
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          const a = data[i + 3];

          if (a !== 255) {
            if (r > a || g > a || b > a) {
              return false;
            }
          }
        }

        return true;
      }

      // premultiplyAlpha('textures/particle_blurred.png');
      // premultiplyAlpha('textures/particle_brush.png');
      // premultiplyAlpha('textures/canvas.png');
      // premultiplyAlpha('debug_circle.png');
    </script>
  </body>
</html>
